## Input format

The used file format consists of sections `camera`, `model`, `point_light`,
`environment_light`, `render` and `image`. Sections
start with a line consisting of only the section name.

Every 
section has some subsections. Subsections are simply lines starting
with the name of the subsections. For every section there can be
at most one subsection with any given subsection name.
Subsections can have default values
which are used if no explicit values are provided.

If sections `camera`, `environment_light` or  `render` have not been
specified, then ones with default parameters will be generated by the parser.

Lines starting with `//` will be ignored.

### 'camera'
At most one per file. Defines the camera used for rendering. Subsections are
`pos`, `front`, `up`, `x_fov` and `y_fov`.

* `pos x y z`:
  * x, y and z are numbers.
  * The position of the camera.
* `front x y z`:
  * x, y and z are numbers. `norm(x, y, z) > 0`
  * The vector defining the front direction of the camera. The middle 
    point of the image plane is at `pos` + `front`. Only things in the
    front of the image plane will be rendered.
* `up x y z`:
  * x, y and z are numbers. `norm(x, y, z) > 0`. Should be perpendicular to `front`
  * The vector defining the up direction of the camera.
* `x_fov x`:
  * `0 < x < 180`
  * The x-axis field of view in degrees.
* `y_fov y`:
  * `0 < y < 180`
  * The y-axis field of view in degrees.

Default values for these
are:
```
pos 0.0 0.0 0.0
front 0.0 0.0 -1.0
up 0.0 1.0 0.0
x_fov 90
y_fov 90
```

### `model`
Any number of these can be in one file. Subsections are:

* `file x`: 
 * x is a string without whitespaces.
 * The relative path to the loaded model. See section Model format
   for more information. *Required* subsection.
* `pos x y z': 
 * x, y and z are numbers.
 * The position of the model.
* `normal t`:
 * t is either `smooth` or `rough`
 * *Ignored if the model has defined normals*.
 * The type of generated normals.

Default values are:
```
pos 0.0 0.0 0.0
normal rough
```

### `point\_light`
Any number of these can be in one file. Subsections are:

* `pos x y z`:
  * x, y and z are numbers.
  * The position of the point light.
* `color r g b`:
  * `r, g, b >= 0`
  * Color of the light. 

Default values are:
```
pos 0.0 0.0 0.0
color 1.0 1.0 1.0

```
### `environment\_light`
At most one per file. Defines the environmen light i.e. the light
that is "seen" by the rays that don't hit any objects. If the type
of the light is set to `uniform`, then the color will be the same 
no matter the direction of the ray. If the type is set to `directed`
then the brightness is `color * max(0.0, cos(alpha))^exp` where
`alpha` is the angle between the ray and `direction` of the environment
light.

Subsections are:

* `color r g b`:
  * `r, g, b >= 0`
  * Color of the environment light
* `type t`:
  * t is either `uniform` or `directed`
* `direction x y z`
  * *Ignored if `type uniform` has been set*
  * x, y and z are numbers. `norm(x, y, z) > 0`
  * Direction from which the light rays are coming the most intensely
* `exp e`:
  * *Ignored if `type uniform` has been set*
  * `e > 0`
  * Defines the directinality of the light. 

Default values are:
```
color 0.0 0.0 0.0
type uniform
direction 0.0 1.0 0.0
exp 1.0
```
### `render`
Parameters for the renderer.

Subsections are:
* `width px`:
  * px is an integer. `px > 0`
  * Width of the rendered image in pixels.
* `height px`:
  * px is an integer. `px > 0`
  * Height of the rendered image in pixels
* `pixel\_rays r`:
  * r is an integer. `r > 0`
  * Number of rays per pixel. If `r == 1` then the ray will be shot
    to the middle of the pixel. Otherwise `r` rays will be sampled
    randomly from a uniform distribution inside the pixel.
* `depth d`:
  * d is an integer. `d > 0`
  * Maximum recursion depth for the raytracing.
* `branch b`
  * b is an integer. `b > 0`
  * The number of rays that a ray is split into every time
    it hits something.

Default values are:
```
width 500
height 500
pixel_rays 1
depth 1
branch 1
```

### `image`
Any number can be present in a file.
Parameters for saving the results of `render`. The operations are
applied to the image in the order: truncate, scale, save. 

Subsections are:
* `file f`:
  * *Required subsection*
  * f is a string without whitespaces.
  * Filename of the saved image.
* `truncate f`
  * 0.0 < f <= 1.0
  * Truncate pixel color values to the value of `f * n_values`th least
    bright pixel where `n_values = n_pixels * 3`. Used to prevent
    the very brightest pixels from dimming down the image.
* `scale_max x`:
  * `x > 0`. *Probably you want `x <= 1`*
  * Value to which the brightest value in the image is scaled to. 
    At saving, values above 1 will not be displayed correctly.
Default values are:
```
truncate 1
scale_max = 1.0
```

## Model format
The program uses the Assimp library to load the models. Many different
formats might work but the program has been only tested with
Wavefront .obj and accompanying .mtl files.
(see https://en.wikipedia.org/wiki/Wavefront_.obj_file )

Currently the program supports the following material properties:
* 'Ka' this is interpreted as emission. The material will look like
   a perpendicular light with radiance `Ka` is always shone to it and 
   the material is perfectly diffuse. *Note that this means that
   the object will look equally bright from every direction but 
   will illuminate other objects the most to the normal direction.*
* `Kd` the diffuse color.
* `Ks` and `Ns`. The specular color and exponent. Used as in the
  original Phong model. High specular exponents (>100 000) can be used
  to mimic a material with perfect reflections/refractions (i.e. mirror). 
* `d` and `Kt`. The tranparency will be `(1.0 - d) * Kt`.
* `Ni` is the optical density of the side to which the triangle normal
   doesn't point to. Optical density of the other side is always
   assumed to be 1.

No guarantees about the default values of these should be assumed.
